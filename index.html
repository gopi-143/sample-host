<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Happy Diwali</title>
  <style>
    :root{
      --bg:#0b1020;
      --card:#11131b;
      --accent:#ffb400;
      --muted:#cbd5e1;
    }
    html,body{height:100%;margin:0;font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;}
    body{
      background: radial-gradient(1200px 600px at 10% 10%, #2a2140 0%, transparent 10%),
                  radial-gradient(1000px 500px at 90% 90%, #142335 0%, transparent 12%),
                  var(--bg);
      color:var(--muted);
      display:flex;align-items:center;justify-content:center;
    }
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border-radius:18px;
      padding:32px;
      width:min(860px, 94vw);
      box-shadow: 0 10px 30px rgba(2,6,23,0.6);
      display:grid;gap:18px;place-items:center;
      position:relative;overflow:hidden;
    }
    h1{
      margin:0;
      font-size: clamp(28px, 5vw, 48px);
      color: white;
      letter-spacing: 0.6px;
      text-align:center;
    }
    p{margin:0;color: #d9e6ff88;text-align:center;}
    .btn{
      background:var(--accent);border:none;padding:10px 18px;border-radius:10px;font-weight:600;cursor:pointer;
      box-shadow: 0 6px 18px rgba(255,180,64,0.14);
    }
    .controls{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;}
    #overlay{
      position:absolute;inset:0;background:linear-gradient(180deg, rgba(0,0,0,0.35), rgba(0,0,0,0.45));
      display:flex;align-items:center;justify-content:center;padding:20px;
    }
    .modal{
      max-width:720px;background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
      border-radius:14px;padding:26px;border:1px solid rgba(255,255,255,0.03);text-align:center;
      box-shadow: 0 12px 40px rgba(0,0,0,0.7);
    }
    .small{font-size:13px;color:#cbd5e1aa;margin-top:8px;}
    canvas{position:absolute;left:0;top:0;pointer-events:none;}
    footer{font-size:12px;color:#9fb2d6;margin-top:8px;}
  </style>
</head>
<body>
  <div class="card" id="card">
    <canvas id="confetti"></canvas>
    <div id="overlay">
      <div class="modal" role="dialog" aria-labelledby="greet">
        <h1 id="greet">Happy Diwali!</h1>
        <p class="small" id="sub">Wishing joy, lights, and sweets üç¨</p>
        <div style="height:16px"></div>
        <div class="controls">
          <button class="btn" id="openBtn">Open the Surprise</button>
          <button class="btn" id="muteBtn" style="background:#2a3344;color:var(--muted)">Toggle Sound</button>
        </div>
        <p class="small" style="margin-top:12px">Open this link on a desktop or phone ‚Äî allow audio if you want sound.</p>
      </div>
    </div>

    <h1 id="mainTitle" style="display:none">Happy Diwali, <span id="nameText">Nikki</span> ‚ú®</h1>
    <p id="desc" style="display:none">May your Diwali be filled with lights and laughter.</p>
    <footer id="footer" style="display:none">Sent by bestoo</footer>
  </div>

  <!-- Optional small audio (base64 short chime) -->
  <audio id="chime" src="data:audio/mp3;base64,//uQZAAAAAAAAAAAAAAAAAAAAAA..." preload="auto"></audio>

  <script>
    // --- CONFIG ---
    const DEFAULT_NAME = 'Nikki';
    const CONFETTI_PARTICLES = 120;
    const AUTO_CONFETTI_DURATION_MS = 7000;

    // --- Utilities ---
    function getParam(name){
      const params = new URLSearchParams(location.search);
      return params.get(name);
    }

    // resolve name (support ?name=Nikki)
    const name = (getParam('name') || DEFAULT_NAME).trim() || DEFAULT_NAME;

    // elements
    const overlay = document.getElementById('overlay');
    const openBtn = document.getElementById('openBtn');
    const muteBtn = document.getElementById('muteBtn');
    const mainTitle = document.getElementById('mainTitle');
    const nameText = document.getElementById('nameText');
    const desc = document.getElementById('desc');
    const footer = document.getElementById('footer');
    const chime = document.getElementById('chime');

    nameText.textContent = name;
    document.getElementById('greet').textContent = `Happy Diwali, ${name}!`;

    let soundOn = true;
    // toggle sound
    muteBtn.addEventListener('click', () => {
      soundOn = !soundOn;
      muteBtn.style.background = soundOn ? 'var(--accent)' : '#2a3344';
      muteBtn.style.color = soundOn ? 'black' : 'var(--muted)';
      if(soundOn) try { chime.play().catch(()=>{}); } catch(e){}
    });

    // show full card (revealed state)
    function reveal() {
      overlay.style.display = 'none';
      mainTitle.style.display = '';
      desc.style.display = '';
      footer.style.display = '';
      if(soundOn) try { chime.play().catch(()=>{}); } catch(e){}
      startConfettiFor(AUTO_CONFETTI_DURATION_MS);
    }

    openBtn.addEventListener('click', reveal);

    // Also reveal on Enter key (accessibility)
    openBtn.addEventListener('keyup', (e) => { if(e.key === 'Enter') reveal(); });

    // --- Confetti (simple particle system) ---
    const canvas = document.getElementById('confetti');
    const ctx = canvas.getContext('2d');
    let W = canvas.width = window.innerWidth;
    let H = canvas.height = window.innerHeight;
    window.addEventListener('resize', () => { W = canvas.width = window.innerWidth; H = canvas.height = window.innerHeight; });

    function rand(min, max){ return Math.random()*(max-min) + min; }
    class Particle {
      constructor(){
        this.reset();
      }
      reset(){
        this.x = rand(0, W);
        this.y = rand(-H, 0);
        this.size = rand(6, 16);
        this.vx = rand(-1.5, 1.5);
        this.vy = rand(2, 6);
        this.rot = rand(0, Math.PI*2);
        this.vr = rand(-0.1, 0.1);
        this.color = `hsl(${Math.floor(rand(20, 50))}, 90%, ${Math.floor(rand(45,65))}%)`;
        this.tilt = rand(-0.3,0.3);
      }
      update(){
        this.x += this.vx;
        this.y += this.vy;
        this.rot += this.vr;
        this.vy += 0.02; // gravity
        if(this.y > H + 40) this.reset();
      }
      draw(ctx){
        ctx.save();
        ctx.translate(this.x, this.y);
        ctx.rotate(this.rot);
        ctx.fillStyle = this.color;
        ctx.fillRect(-this.size/2, -this.size/2, this.size, this.size*0.6);
        ctx.restore();
      }
    }
    const particles = [];
    function spawn(n){
      for(let i=0;i<n;i++) particles.push(new Particle());
    }
    function step(){
      ctx.clearRect(0,0,W,H);
      for(const p of particles){
        p.update();
        p.draw(ctx);
      }
      animationId = requestAnimationFrame(step);
    }
    let animationId = null;

    function startConfettiFor(duration = 5000){
      if(particles.length === 0) spawn(CONFETTI_PARTICLES);
      if(animationId === null) step();
      if(duration) setTimeout(stopConfetti, duration);
    }
    function stopConfetti(){
      cancelAnimationFrame(animationId);
      animationId = null;
      particles.length = 0;
      ctx.clearRect(0,0,W,H);
    }

    // Auto-show modal for small screens (helpful) - but keep overlay visible until user clicks
    // Optionally, auto-trigger reveal on first open after small delay (comment out if unwanted)
    // setTimeout(reveal, 12000); // DON'T auto reveal ‚Äî leaving commented for user control

    // Improve accessibility: focus the button
    openBtn.focus();

    // If user shares link with ?autoplay=1, reveal automatically (useful if you want automatic greeting)
    if (new URLSearchParams(location.search).get('autoplay') === '1') {
      // give small delay to allow audio permission prompts
      setTimeout(reveal, 700);
    }

    // small friendly console message (for curious devs)
    console.log('Happy Diwali page for', name);
  </script>
</body>
</html>
